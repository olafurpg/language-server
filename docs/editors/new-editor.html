<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Integrating a new editor · Metals</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Metals is a language server implemented in Scala that communicates with a single&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Integrating a new editor · Metals"/><meta property="og:type" content="website"/><meta property="og:url" content="http://scalameta.org/metals/index.html"/><meta property="og:description" content="&lt;p&gt;Metals is a language server implemented in Scala that communicates with a single&lt;/p&gt;
"/><meta property="og:image" content="http://scalameta.org/metals/img/scalameta-logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="http://scalameta.org/metals/img/scalameta-logo.png"/><link rel="shortcut icon" href="/metals/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"/><link rel="stylesheet" href="/metals/css/custom.css"/><link rel="stylesheet" href="/metals/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/metals/"><img class="logo" src="/metals/img/scalameta-logo.png" alt="Metals"/><h2 class="headerTitleWithLogo">Metals</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/metals/docs/editors/overview.html" target="_self">Docs</a></li><li class=""><a href="https://github.com/olafurpg/metals" target="_blank">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Text Editors</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Text Editors</h3><ul><li class="navListItem"><a class="navItem" href="/metals/docs/editors/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/editors/vscode.html">Visual Studio Code</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/editors/atom.html">Atom</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/editors/vim.html">Vim</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/editors/sublime.html">Sublime Text</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/metals/docs/editors/new-editor.html">Integrating a new editor</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Build Tools</h3><ul><li class="navListItem"><a class="navItem" href="/metals/docs/build-tools/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/build-tools/sbt.html">sbt</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/build-tools/bloop.html">Bloop</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/build-tools/new-build-tool.html">Integrating a new build tool</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Contributing</h3><ul><li class="navListItem"><a class="navItem" href="/metals/docs/contributors/project-goals.html">Project Goals</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/contributors/getting-started.html">Contributing to Metals</a></li><li class="navListItem"><a class="navItem" href="/metals/docs/contributors/updating-website.html">Contributing to the website</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/olafurpg/metals/edit/master/docs/editors/new-editor.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Integrating a new editor</h1></header><article><div><span><p>Metals is a language server implemented in Scala that communicates with a single
client over <a href="https://www.jsonrpc.org/specification">JSON-RPC</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="requirements"></a><a href="#requirements" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Requirements</h2>
<ul>
<li>Java 8. Metals does not yet work with Java 11, see <a href="https://github.com/scalameta/scalameta/issues/1779">scalameta/scalameta#1779</a></li>
<li>macOS, Linux or Windows. Metals is not developed on Windows but CI runs tests on Windows so
please report issues if you encounter problems.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="starting-the-server"></a><a href="#starting-the-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starting the server</h2>
<p>Use <a href="https://github.com/coursier/coursier">Coursier</a> to obtain the JVM classpath
of Metals:</p>
<pre><code class="hljs css language-sh">coursier bootstrap org.scalameta:metals_2.12:SNAPSHOT -o metals -f
</code></pre>
<p>(optional) It is recommended to enable JVM string de-duplication and provide
generous stack size and memory options.</p>
<pre><code class="hljs css language-sh">coursier bootstrap \
  --java-opt -XX:+UseG1GC \
  --java-opt -XX:+UseStringDeduplication  \
  --java-opt -Xss4m \
  --java-opt -Xms1G \
  --java-opt -Xmx4G \
  org.scalameta:metals_2.12:SNAPSHOT -o metals -f
</code></pre>
<p>JSON-RPC communication takes place over standard input/output so the Metals
server does not print anything to the console when it starts. Instead, before
establishing a connection with the client, Metals logs notifications to a global
directory:</p>
<pre><code class="hljs css language-sh"><span class="hljs-comment"># macOS</span>
~/Library/Caches/org.scalameta.metals/global.log
<span class="hljs-comment"># Linux</span>
<span class="hljs-variable">$XDG_CACHE_HOME</span>/org.scalameta.metals/global.log
<span class="hljs-comment"># Linux (alternative)</span>
<span class="hljs-variable">$HOME</span>/.cache/org.scalameta.metals/global.log
<span class="hljs-comment"># Windows</span>
{FOLDERID_LocalApplicationData}\.cache\org.scalameta.metals\global.log
</code></pre>
<p>After establishing a connection with the client, Metals redirects logs to the
<code>.metals/metals.log</code> file in the LSP workspace root directory.</p>
<p>Metals supports two kinds of JSON-RPC endpoints:</p>
<ul>
<li><a href="#language-server-protocol">Language Server Protocol</a>: for the main
functionality of the server, including editor text synchronization and
semantic features such as goto definition.</li>
<li><a href="#metals-extensions">Metals extensions</a>: for additional functionality that is
missing in LSP but improves the user experience.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="language-server-protocol"></a><a href="#language-server-protocol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Language Server Protocol</h2>
<p>Consult the
<a href="https://microsoft.github.io/language-server-protocol/specification">LSP specification</a>
to learn more more how LSP works. Metals uses the following endpoints from the
specification.</p>
<h3><a class="anchor" aria-hidden="true" id="initialize"></a><a href="#initialize" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>initialize</code></h3>
<ul>
<li>the <code>rootUri</code> field is used to configure Metals for that workspace directory.
The working directory for where server is started has no significant meaning.</li>
<li>at this point, Metals uses only full text synchronization. In the future, it
will be able to use incremental text synchronization.</li>
<li><code>didChangeWatchedFiles</code> client capability is used to determine whether to
register file watchers.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="initialized"></a><a href="#initialized" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>initialized</code></h3>
<p>Triggers build server initialization and workspace indexing. The <code>initialized</code>
notification is critical for any Metals functionality to work.</p>
<h3><a class="anchor" aria-hidden="true" id="shutdown"></a><a href="#shutdown" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>shutdown</code></h3>
<p>It is very important that the client sends a shutdown request in order for
Metals to clean up open resources.</p>
<ul>
<li>persists incremental compilation analysis files. Without a <code>shutdown</code> hook,
Metals will need to re-compile the entire workspace on next startup.</li>
<li>stops ongoing processes such as <code>sbt bloopInstall</code></li>
<li>closes database connections</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="exit"></a><a href="#exit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>exit</code></h3>
<p>Kills the process using <code>System.exit</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="cancelrequest"></a><a href="#cancelrequest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>$/cancelRequest</code></h3>
<p>Used by <code>metals/slowTask</code> to notify when a long-running process has finished.</p>
<h3><a class="anchor" aria-hidden="true" id="client-registercapability"></a><a href="#client-registercapability" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>client/registerCapability</code></h3>
<p>If the client declares the <code>workspace.didChangeWatchedFiles</code> capability during
the <code>initialize</code> request, then Metals follows up with a
<code>client/registerCapability</code> request to register file watchers for certain glob
patterns.</p>
<h3><a class="anchor" aria-hidden="true" id="textdocument-didopen"></a><a href="#textdocument-didopen" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>textDocument/didOpen</code></h3>
<p>Triggers compilation in the build server for the build target containing the
opened document. Related, see <code>metals/didFocus</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="textdocument-didchange"></a><a href="#textdocument-didchange" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>textDocument/didChange</code></h3>
<p>Required to know the text contents of the current unsaved buffer.</p>
<h3><a class="anchor" aria-hidden="true" id="textdocument-didclose"></a><a href="#textdocument-didclose" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>textDocument/didClose</code></h3>
<p>Cleans up resources.</p>
<h3><a class="anchor" aria-hidden="true" id="textdocument-didsave"></a><a href="#textdocument-didsave" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>textDocument/didSave</code></h3>
<p>Triggers compilation in the build server and analyses if the build needs to be
re-imported.</p>
<h3><a class="anchor" aria-hidden="true" id="textdocument-publishdiagnostics"></a><a href="#textdocument-publishdiagnostics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>textDocument/publishDiagnostics</code></h3>
<p>Metals forwards diagnostics from the build server to the editor client.
Additionally, Metals publishes <code>Information</code> diagnostics for unexpected
compilation errors when navigating external library sources.</p>
<h3><a class="anchor" aria-hidden="true" id="textdocument-definition"></a><a href="#textdocument-definition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>textDocument/definition</code></h3>
<p>Metals supports goto definition for workspace sources in addition to external
library sources.</p>
<ul>
<li>Library sources live under the directory <code>.metals/readonly</code> and they are
marked as read-only to prevent the user from editing them.</li>
<li>The destination location can either be a Scala or Java source file. It is
recommended to have a Java language server installed to navigate Java sources.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="workspace-didchangewatchedfiles"></a><a href="#workspace-didchangewatchedfiles" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>workspace/didChangeWatchedFiles</code></h3>
<p>Same as <code>didSave</code>, triggers compilation and analyses if the build needs to be
re-imported. File watching notifications are optional, the Metals server should
function normally without file watching notifications. However, file watching
notifications improve the user experience especially when file contents change
outside of the editor such as during <code>git checkout</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="window-logmessage"></a><a href="#window-logmessage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>window/logMessage</code></h3>
<p>Used to log non-critical and non-actionable information. The user is only
expected to use the logs for troubleshooting or finding metrics for how long
certain events take.</p>
<h3><a class="anchor" aria-hidden="true" id="window-showmessage"></a><a href="#window-showmessage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>window/showMessage</code></h3>
<p>Used to send critical but non-actionable notifications to the user. For
non-critical notifications, see <code>metals/status</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="window-showmessagerequest"></a><a href="#window-showmessagerequest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>window/showMessageRequest</code></h3>
<p>Used to send critical and actionable notifications to the user. To notify the
user about long running tasks that can be cancelled, the extension
<code>metals/slowTask</code> is used instead.</p>
<h2><a class="anchor" aria-hidden="true" id="metals-extensions"></a><a href="#metals-extensions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Metals extensions</h2>
<p>Editor clients can opt into receiving Metals-specific JSON-RPC requests and
notifications. Metals extensions are not defined in LSP and are not strictly
required for the Metals server to function but it is recommended to implement
them to improve the user experience.</p>
<p>To enable Metals extensions, start the main process with the system property
<code>-Dmetals.extensions=true</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="metals-slowtask"></a><a href="#metals-slowtask" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>metals/slowTask</code></h3>
<p>The Metals slow task request is sent from the server to the client to notify the
start of a long running process with unknown estimated total time. A
<code>cancel: true</code> response from the client cancels the task. A <code>$/cancelRequest</code>
request from the server indicates that the task has completed.</p>
<p><img src="/metals/docs/assets/metals-slow-task.gif" alt="Metals slow task"></p>
<p>The difference between <code>metals/slowTask</code> and <code>window/showMessageRequest</code> is that
<code>slowTask</code> is time-sensitive and the interface should display a timer for how
long the task has been running while <code>showMessageRequest</code> is static.</p>
<p><em>Request</em>:</p>
<ul>
<li>method: <code>metals/slowTask</code></li>
<li>params: <code>MetalsSlowTaskParams</code> defined as follows:</li>
</ul>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">interface</span> MetalsSlowTaskParams {
  <span class="hljs-comment">/** The name of this slow task */</span>
  message: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><em>Response</em>:</p>
<ul>
<li>result: <code>MetalsSlowTaskResponse</code> defined as follows</li>
</ul>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">interface</span> MetalsSlowTaskResult {
  <span class="hljs-comment">/**
   * If true, cancel the running task.
   * If false, the user dismissed the dialogue but want to
   * continue running the task.
   */</span>
  message: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="metals-status"></a><a href="#metals-status" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>metals/status</code></h3>
<p>The Metals status notification is sent from the server to the client to notify
about non-critical and non-actionable events that are happening in the server.
Metals status notifications are a complement to <code>window/showMessage</code> and
<code>window/logMessage</code>. Unlike <code>window/logMessage</code>, status notifications should
always be visible in the user interface. Unlike <code>window/showMessage</code>, status
notifications are not critical meaning that they should not demand too much
attention from the user.</p>
<p>In general, Metals uses status notifications to update the user about ongoing
events in the server such as batch compilation in the build server or when a
successful connection was established with the build server.</p>
<p><img src="/metals/docs/assets/metals-status.gif" alt="Metals status bar"></p>
<p>The &quot;🚀 Imported build&quot; and &quot;🔄 Compiling explorer&quot; messages at the bottom of
the window are <code>metals/status</code> notifications.</p>
<p><em>Notification</em>:</p>
<ul>
<li>method: <code>metals/status</code></li>
<li>params: <code>MetalsStatusParams</code> defined as follows:</li>
</ul>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">interface</span> MetalsStatusParams {
  <span class="hljs-comment">/** The text to display in the status bar. */</span>
  text: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/** If true, show the status bar. */</span>
  show?: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-comment">/** If true, hide the status bar. */</span>
  hide?: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-comment">/** If set, display this message when user hovers over the status bar. */</span>
  tooltip?: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/** If set, execute this command when the user clicks on the status bar item. */</span>
  command?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="metals-didfocus"></a><a href="#metals-didfocus" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>metals/didFocus</code></h3>
<p>The Metals did focus notification is sent from the client to the server when the
editor changes focus to a new text document. Unlike <code>textDocument/didOpen</code>, the
did focus notification is sent even when the text document is already open.</p>
<p><img src="/metals/docs/assets/metals-did-focus.gif" alt="Metals did focus"></p>
<p>Observe that the compilation error appears as soon as <code>UserTest.scala</code> is
focused even if the text document was already open before. The LSP
<code>textDocument/didOpen</code> notification is only sent the first time a document so it
is not possible for the language server to re-trigger compilation when moves
focus back to <code>UserTest.scala</code> that depends on APIs defined in <code>User.scala</code>.</p>
<p><em>Notification</em>:</p>
<ul>
<li>method: <code>metals/didFocus</code></li>
<li>params: <code>string</code>, the URI of the document where the focused was moved to.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/metals/docs/editors/sublime.html"><span class="arrow-prev">← </span><span>Sublime Text</span></a><a class="docs-next button" href="/metals/docs/build-tools/overview.html"><span>Build Tools Overview</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#requirements">Requirements</a></li><li><a href="#starting-the-server">Starting the server</a></li><li><a href="#language-server-protocol">Language Server Protocol</a><ul class="toc-headings"><li><a href="#initialize"><code>initialize</code></a></li><li><a href="#initialized"><code>initialized</code></a></li><li><a href="#shutdown"><code>shutdown</code></a></li><li><a href="#exit"><code>exit</code></a></li><li><a href="#cancelrequest"><code>$/cancelRequest</code></a></li><li><a href="#client-registercapability"><code>client/registerCapability</code></a></li><li><a href="#textdocument-didopen"><code>textDocument/didOpen</code></a></li><li><a href="#textdocument-didchange"><code>textDocument/didChange</code></a></li><li><a href="#textdocument-didclose"><code>textDocument/didClose</code></a></li><li><a href="#textdocument-didsave"><code>textDocument/didSave</code></a></li><li><a href="#textdocument-publishdiagnostics"><code>textDocument/publishDiagnostics</code></a></li><li><a href="#textdocument-definition"><code>textDocument/definition</code></a></li><li><a href="#workspace-didchangewatchedfiles"><code>workspace/didChangeWatchedFiles</code></a></li><li><a href="#window-logmessage"><code>window/logMessage</code></a></li><li><a href="#window-showmessage"><code>window/showMessage</code></a></li><li><a href="#window-showmessagerequest"><code>window/showMessageRequest</code></a></li></ul></li><li><a href="#metals-extensions">Metals extensions</a><ul class="toc-headings"><li><a href="#metals-slowtask"><code>metals/slowTask</code></a></li><li><a href="#metals-status"><code>metals/status</code></a></li><li><a href="#metals-didfocus"><code>metals/didFocus</code></a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer" style="background-color:#1B555C"><section class="sitemap"><a href="/metals/" class="nav-home"><img src="/metals/img/scalameta-logo.png" alt="Metals" width="66" height="58"/></a><div><h5>Docs</h5><a href="
                /metals/docs/overview.html">Project Goals</a><a href="
                /metals/docs/getting-started-contributors.html">Contributing</a></div><div><h5>Community</h5><a href="https://gitter.im/scalameta/metals" target="_blank">Chat on Gitter</a></div><div><h5>More</h5><a href="https://github.com/olafurpg/metals" target="_blank">GitHub</a></div></section><section class="copyright">Copyright © 2018 Metals</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'c865f6d974a3072a35d4b53d48ac2307',
                indexName: 'metals',
                inputSelector: '#search_input_react'
              });
            </script></body></html>